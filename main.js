(()=>{"use strict";var e={formElement:".form",formInput:".form__input",saveButton:".form__save-button",errorClass:".form__input-error",inactiveSaveButton:"form__save-button_inactive",inputErrorType:"form__input_type_erorr",inputErrorClass:"form__input-error_active",validationMessages:{emptyString:"Вы пропустили это поле.",semiEmptyString:"Минимальное количество символов: 2. Длина текста сейчас: 1 символ.",name:"Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы",activity:"Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы",place:"Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы",link:"Введите адрес сайта."},validationRules:{name:{required:!0,minlength:2,maxlength:40,pattern:/^[a-zA-Zа-яА-ЯёЁ_ -]+$/},activity:{required:!0,minlength:2,maxlength:200,pattern:/^[a-zA-Zа-яА-ЯёЁ_ -]+$/},place:{required:!0,minlength:2,maxlength:30,pattern:/^[a-zA-Zа-яА-ЯёЁ_ -]+$/},link:{required:!0,url:!0}}},t=document.querySelector('input[name="cardTitle"]'),n=document.querySelector('input[name="cardLink"]'),r=document.querySelector(".elements"),o=document.querySelector("#elementTemplate").content,a=document.querySelector("#image-popup"),c=document.querySelector(".popup__image-caption"),i=document.querySelector(".popup__image"),u=document.querySelector("#profile-popup"),l=document.querySelector('input[name="username"]'),s=document.querySelector(".profile__user-name"),d=document.querySelector(".profile__user-status"),m=document.querySelector(".profile__avatar"),f=document.querySelector('input[name="userstatus"]'),p=document.querySelector(".profile__edit-button"),v=document.querySelector(".profile__add-button"),y=document.querySelector("#cards-popup"),h=(document.querySelector(".popup"),Array.from(document.querySelectorAll(".popup"))),_=document.querySelector("#user-editor"),S=document.querySelector("#card-poster"),q=document.querySelector("#submitButtonCard"),g=document.getElementById("submitButtonAvatar"),E=document.querySelector("#avatar-url"),b=(document.querySelector("#editPofileAvatar"),document.querySelector("#avatar-popup")),k=document.querySelector(".profile__avatar-edit-button");function L(e){e.classList.add("popup_opened"),document.addEventListener("keydown",x)}function C(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",x)}function x(e){"Escape"===e.key&&C(document.querySelector(".popup_opened"))}var A=function(e,t,n,r){r.textContent=n?e:t},B={id:null},T={BaseUrl:"https://nomoreparties.co/v1/plus-cohort-23",headers:{authorization:"6239fa52-ec5e-455e-8a3f-385f9bd2160a","Content-Type":"application/json"}};function U(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function P(e){!function(e){r.prepend(e)}(function(e){var t=o.querySelector(".elements__element").cloneNode(!0),n=t.querySelector(".elements__img"),r=t.querySelector(".elements__title"),u=t.querySelector(".elements__like"),l=t.querySelector(".elements__like-quantity"),s=t.querySelector(".elements__delete");return n.src=e.link,n.alt=e.name,r.textContent=e.name,l.textContent=e.likes.length||0,e.owner._id===B.id&&s.addEventListener("click",(function(){return function(e){return fetch("".concat(T.BaseUrl,"/cards/").concat(e._id),{method:"DELETE",headers:T.headers}).then((function(e){return U(e)}))}(e).then((function(){t.closest(".elements__element").remove()})).catch((function(e){console.error(e)}))})),e.owner._id===B.id?s.style.display="block":s.style.display="none",u.addEventListener("click",(function(t){var n=t.target.closest(".elements__element").querySelector(".elements__like-quantity");u.classList.contains("elements__like_active")?function(e){return fetch("".concat(T.BaseUrl,"/cards/likes/").concat(e._id),{method:"DELETE",headers:T.headers}).then((function(e){return U(e)}))}(e).then((function(e){n.textContent=e.likes.length,u.classList.remove("elements__like_active")})).catch((function(e){console.error(e)})):function(e){return fetch("".concat(T.BaseUrl,"/cards/likes/").concat(e._id),{method:"PUT",headers:T.headers}).then((function(e){return U(e)}))}(e).then((function(e){console.log(e),n.textContent=e.likes.length,u.classList.add("elements__like_active")})).catch((function(e){console.error(e)}))})),e.likes.some((function(e){return e._id===B.id}))&&u.classList.add("elements__like_active"),n.addEventListener("click",(function(){L(a),i.src=e.link,i.alt=e.name,c.textContent=e.name})),t}(e))}var j=function(t,n){var r=t.every((function(e){return e.validity.valid}));n.disabled=!r,n.classList.toggle(e.inactiveSaveButton,!r)},w=function(e,t){var n=e.querySelector(t.saveButton),r=Array.from(e.querySelectorAll(t.formInput)),o=function(e){var n=e.nextElementSibling;e.classList.add(t.inputErrorType),n.classList.add(t.inputErrorClass)};r.forEach((function(e){e.addEventListener("input",(function(){!function(e){var a=e.nextElementSibling;""===e.value?(o(e),a.textContent=e.dataset.errorEmptyString):"url"===e.type&&e.validity.typeMismatch?(o(e),a.textContent=e.dataset.errorLink):1===e.value.trim().length?(o(e),a.textContent=e.dataset.errorSemiEmptyString):e.validity.patternMismatch?(o(e),a.textContent=e.dataset.errorPattern):function(e){var n=e.nextElementSibling;e.classList.remove(t.inputErrorType),n.classList.remove(t.inputErrorClass)}(e),j(r,n)}(e)}))})),j(r,n)},O=function(){j(Array.from(S.querySelectorAll(e.formInput)),S.querySelector(e.saveButton))};function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}k.addEventListener("click",(function(){return E.value="",O(),void L(b)})),g.addEventListener("submit",(function(e){e.preventDefault();var t=E.value;A("Сохранение...","Сохранить",!0,g),function(e){return fetch("".concat(T.BaseUrl,"/users/me/avatar"),{method:"PATCH",headers:T.headers,body:JSON.stringify({avatar:e})}).then((function(e){return U(e)}))}(t,formValidationConfig).then((function(e){m.src=e,A("Сохранение...","Сохранить",!1,g),C(b)})).catch((function(e){console.error(e)}))})),p.addEventListener("click",(function(){return l.value=s.textContent,f.value=d.textContent,void L(u)})),u.addEventListener("submit",(function(e){e.preventDefault();var t,n,r=l.value,o=f.value;m.alt=r,A("Сохранение...","Сохранить",!0,submitButtonProfile),(t=r,n=o,fetch("".concat(T.BaseUrl,"/users/me"),{method:"PATCH",headers:T.headers,body:JSON.stringify({name:t,about:n,avatar:undefined})}).then((function(e){return U(e)}))).then((function(e){s.textContent=l.value,d.textContent=f.value,A("Сохранение...","Сохранить",!1,submitButtonProfile),C(u),s.textContent=e.name,d.textContent=e.about})).catch((function(e){console.error(e)}))})),v.addEventListener("click",(function(){return O(),void L(y)})),y.addEventListener("submit",(function(e){e.preventDefault();var r=t.value,o=n.value;A("Сохранение...","Сохранить",!0,q),function(e,t){return fetch("".concat(T.BaseUrl,"/cards"),{method:"POST",headers:T.headers,body:JSON.stringify({name:e,link:t})}).then((function(e){return U(e)}))}(r,o).then((function(e){P(e),C(y),t.value="",n.value="",A("Сохранение...","Сохранить",!1,q)})).catch((function(e){console.error(e)}))})),function(e){w(_,e),w(S,e),w(b,e)}(e),h.forEach((function(e){e.addEventListener("click",(function(t){t.target.classList.contains("popup__close-button")&&C(e)})),e.addEventListener("click",(function(t){t.currentTarget===t.target&&C(e)}))})),Promise.all([fetch("".concat(T.BaseUrl,"/users/me"),{headers:T.headers}).then((function(e){return U(e)})),fetch("".concat(T.BaseUrl,"/cards"),{headers:T.headers}).then((function(e){return U(e)}))]).then((function(e){var t,n,r,o=(r=2,function(e){if(Array.isArray(e))return e}(n=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,c,i=[],u=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(i.push(r.value),i.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(l)throw o}}return i}}(n,r)||function(e,t){if(e){if("string"==typeof e)return I(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?I(e,t):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=o[0],c=o[1];t=a._id,B.id=t,s.textContent=a.name,d.textContent=a.about,m.src=a.avatar,m.alt=a.name,c.reverse().forEach((function(e){P(e)}))})).catch((function(e){console.error(e)}))})();